---
title: "Benchmark Summary"
author: "Ruoxi Liu"
date: "6/19/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 10, fig.height = 6)
```

```{r}
library(tidyr)
library(ggplot2)
library(cowplot)
library(gridExtra)
library(dplyr)
library(grid)
library(here)
```

```{r}
files <- list.files(path= here("output_tables"), pattern="*.csv", full.names=TRUE, recursive=FALSE)

final_table <- NULL

for (i in (1:length(files))){
  temp_table <- read.csv(file = files[i], header=TRUE, sep=",")
  final_table <- rbind(final_table, temp_table)
}
final_table <- final_table %>% 
  mutate(method = factor(method, levels = c("kmeans", "mbkmeans", "hdf5")), 
         batch_size_perc = factor(scales::percent(final_table$batch_size), 
                             levels = c("0.5%", "1.0%", "5.0%", "10.0%", "20.0%", "50.0%", "80.0%", "100.0%")))
levels(final_table$method) <- c("kmeans", "mbkmeans", "mbkmean_hdf5")
```

Fix batch size and k (study effects of observation)
```{r, warning=FALSE}
p1 <- final_table %>% 
  #dplyr::filter(!(method == "kmeans"))%>%
  dplyr::group_by(method, observations, batch_size_perc) %>% 
  dplyr::summarize(mean = mean(memory), 
                   sd = sd(memory)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
        labs(title = "Assessing Memory Usage for Increasing No. Obs\n(fixed batch size)") + 
        xlab("Number of cells (thousands)") + 
        ylab("Memory (Mb)") + 
  facet_wrap(~batch_size_perc) + 
  theme(legend.position = "top", legend.justification= "center") + 
  scale_color_discrete(name = "Method")

p1
```

Fix observation and k (study effects of batch size)
```{r, warning=FALSE}
final_table %>% 
  dplyr::group_by(method, observations, batch_size) %>% 
  dplyr::summarize(mean = mean(memory), 
                   sd = sd(memory)) %>% 
  ggplot(aes(x = batch_size, y = mean, color = method)) +
          geom_line() +
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd))+
        labs(title = "Assessing Memory Usage for Increasing Batch Size\n(fixed number of observations)") + 
        xlab("Batch size") + 
        ylab("Memory (Mb)") + 
  facet_wrap(~observations, scales = "free") + 
  theme(legend.position = "top", legend.justification= "center") + 
  scale_color_discrete(name = "Method")
```