---
title: mbkmeans manuscript figures
author: Ruoxi Liu, Stephanie Hicks, Davide Risso, Elizabeth Purdom
output: 
    html_document:
        theme: cosmo 
        toc: true
        toc_float: true
        highlight: tango
        number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 14, fig.height = 10)
```

```{r, message=FALSE, warning=FALSE}
library(here)
library(tidyr)
library(dplyr)
library(ggplot2)
library(cowplot)
library(ggpubr)
library(gridExtra)
library(grid)
```

# Load data

## Memory
```{r}
files_mem <- list.files(path= here("output_tables", "mem"), 
                        pattern="*.csv", full.names=TRUE, recursive=FALSE)
mem_table <- NULL
for (i in (1:length(files_mem))){
  temp_table <- read.csv(file = files_mem[i], header=TRUE, sep=",")
  mem_table <- rbind(mem_table, temp_table)
}
mem_table <- mem_table %>% 
  mutate(method = factor(method, levels = c("kmeans", "mbkmeans", "hdf5")), 
         batch_size_perc = factor(scales::percent(mem_table$batch_size), 
                             levels = c("0.5%", "1.0%", "5.0%", "10.0%",
                                        "20.0%", "50.0%", "80.0%", "100.0%")))
levels(mem_table$method) <- c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new")
mem_table <- na.omit(mem_table)
```

## Time 

```{r}
files_time <- list.files(path= here("output_tables", "time"), 
                         pattern="*.csv", full.names=TRUE, recursive=FALSE)
time_table <- NULL
for (i in (1:length(files_time))){
  temp_table <- read.csv(file = files_time[i], header=TRUE, sep=",")
  time_table <- rbind(time_table, temp_table)
}
time_table <- time_table %>% 
  mutate(method = factor(method, levels = c("kmeans", "mbkmeans", "hdf5")), 
         batch_size_perc = factor(scales::percent(time_table$batch_size), 
                             levels = c("0.5%", "1.0%", "5.0%", "10.0%", 
                                        "20.0%", "50.0%", "80.0%", "100.0%")))
levels(time_table$method) <- c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new")
```

## Accuracy 

### Relative batch sizes
```{r}
files_acc <- list.files(path= here("output_tables", "acc"), 
                        pattern="*.csv", full.names=TRUE, recursive=FALSE)
acc_table <- NULL
for (i in (1:length(files_acc))){
  temp_table <- read.csv(file = files_acc[i], header=TRUE, sep=",")
  acc_table <- rbind(acc_table, temp_table)
}
acc_table <- acc_table %>% 
  mutate(method = factor(method, levels = c("kmeans", "mbkmeans", "hdf5")), 
         batch_size_perc = factor(scales::percent(acc_table$batch_size), 
                             levels = c("0.5%", "1.0%", "5.0%", 
                                        "10.0%", "20.0%","35.0%", "50.0%"))) %>%
  transform(normal_WCSS = WCSS/observations)
levels(acc_table$method) <- c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new")
```

### Absolute batch size 

Simulated data
```{r}
files_acc <- list.files(path = here("output_tables", "abs_batch", "acc"), 
                        pattern="*.csv", full.names=TRUE, recursive=FALSE)
acc_table_abs <- NULL
# for (i in (1:length(files_acc))){
for (i in (1:(length(files_acc)-1))){
  temp_table <- read.csv(file = files_acc[i], header=TRUE, sep=",")
  acc_table_abs <- rbind(acc_table_abs, temp_table)
}
acc_table_abs <- acc_table_abs %>% 
  transform(normal_WCSS = WCSS/observations) %>% 
  dplyr::rename(Algorithm = method)
acc_table_abs$Algorithm <- factor(acc_table_abs$Algorithm, 
                               levels = c("kmeans", "mbkmeans", "hdf5"))
levels(acc_table_abs$Algorithm) <- c("k-means", "mbkmeans", "mbkmeans (HDF5)")
```


Real scRNA-seq data
```{r}
files_acc <- list.files(path = here("output_tables", "abs_batch", 
                                    "acc", "real_data"), 
                        pattern="*.csv", full.names=TRUE, recursive=FALSE)
acc_real_table_abs <- NULL
for (i in (1:length(files_acc))){
  temp_table <- read.csv(file = files_acc[i], header=TRUE, sep=",")
  acc_real_table_abs <- rbind(acc_real_table_abs, temp_table)
}
acc_real_table_abs <- acc_real_table_abs %>% 
  transform(normal_WCSS = WCSS/observations) %>% 
  dplyr::rename(Algorithm = method)
acc_real_table_abs$Algorithm <- factor(acc_real_table_abs$Algorithm, 
                               levels = c("kmeans", "mbkmeans", "hdf5"))
levels(acc_real_table_abs$Algorithm) <- c("k-means", "mbkmeans", "mbkmeans (HDF5)")
```


# Figures 

## Figure 1

To be add here. 




## Figure 2

Here we select three sizes of datasets ($N$) and show the accuracy 
as a function of absolute batch size using both simulated and 
real scRNA-seq data. 

### ARI 
```{r, warning=FALSE}
p_ari_obs_line_abs <- acc_table_abs %>% 
  dplyr::filter((observations %in% c(5000,10000,25000)))%>%
  dplyr::group_by(Algorithm, observations, abs_batch) %>% 
  dplyr::summarize(mean = mean(ARI), 
                   sd = sd(ARI)) %>% 
  ggplot(aes(x = abs_batch, y = mean, color = Algorithm)) +
          geom_line() +
          geom_point() +
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05)) +
      ylim(0.95, 1) + 
      labs(title = "Performance of accuracy with three simulated scRNA-seq datasets") + 
        xlab("Absolute batch sizes") + 
        ylab("ARI") + 
  theme(legend.position = "top", legend.justification= "center") +
  facet_wrap(~observations, scales = "free") 
p_ari_obs_line_abs
```

Save the legend on its own
```{r}
my_legend <- cowplot::get_legend(p_ari_obs_line_abs)
```

Resave figure without legend

```{r}
p_ari_obs_line_abs <- 
  p_ari_obs_line_abs + 
  theme(legend.position = "none", legend.justification= "center")
```



### WCSS
```{r, warning=FALSE}
p_wcss_obs_line_abs <- acc_table_abs %>% 
  dplyr::filter((observations %in% c(5000,10000,25000)))%>%
  dplyr::group_by(Algorithm, observations, abs_batch) %>% 
  mutate(q90 = quantile(normal_WCSS, 0.9), row = row_number()) %>% 
  dplyr::filter(normal_WCSS <= q90) %>%
  dplyr::summarize(mean = mean(normal_WCSS), 
                   sd = sd(normal_WCSS)) %>% 
  ggplot(aes(x = abs_batch, y = mean, color = Algorithm)) +
          geom_line() +
          geom_point() +
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
     labs(title = "Performance of accuracy with three simulated scRNA-seq datasets") + 
        xlab("Absolute batch sizes") + 
        ylab("WCSS") + 
  theme(legend.position = "none", legend.justification= "center") +
  facet_wrap(~observations, scales = "free") 
p_wcss_obs_line_abs
```

```{r, warning=FALSE}
p_wcss_real_abs <- acc_real_table_abs %>%   
  dplyr::filter((observations %in% c(5000,10000,25000)))%>%
  dplyr::group_by(observations, Algorithm, abs_batch) %>% 
  mutate(q90 = quantile(normal_WCSS, 0.8), row = row_number()) %>% 
  dplyr::filter(normal_WCSS <= q90) %>%
  dplyr::summarize(mean = median(normal_WCSS), 
                   sd = sd(normal_WCSS)) %>% 
  ggplot(aes(x = abs_batch, y = mean, color = Algorithm)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
  theme(legend.position = "none", legend.justification= "center") +
  labs(title = "Performance of accuracy with three real scRNA-seq datasets") + 
        xlab("Absolute batch sizes") + 
        ylab("WCSS") +
  facet_wrap(~observations, scales = "free") 
p_wcss_real_abs
```

### save fig

```{r}
p2_abs <- ggdraw() +
    draw_plot(as_ggplot(my_legend), x = 0, y = 0.94, width = 1, height = 0.05) + 
    draw_plot(p_ari_obs_line_abs, x = 0, y = 0.62, width = 1, height = .32) +
    draw_plot(p_wcss_obs_line_abs, x = 0, y = 0.31, width = 1, height = .31) +
    draw_plot(p_wcss_real_abs, x = 0, y = 0, width = 1, height = .31) +
    draw_plot_label(label = LETTERS[1:3], size = 25,
                    x = c(0, 0, 0), y = c(1, 0.64, 0.33))
    
p2_abs
pdf(here::here("main", "figs", "fig2.pdf"), width = 10, height =10)
print(p2_abs)
dev.off()
```


### memory and time (under 200K cells)

Performance of memory usage as a function of increasing number of 
cells and batch sizes. 

```{r}
p_mem_obs <- mem_table %>%
  dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  dplyr::filter((observations <= 200000)) %>%
  dplyr::group_by(method, observations, batch_size_perc) %>% 
  dplyr::summarize(mean = mean(memory/1000), 
                   sd = sd(memory/1000)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line() +
          geom_point() +
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
        labs(title = "Memory Usage (RAM) for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Memory Usage (Gb)") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "top", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_mem_obs
```

```{r, warning=FALSE}
p_time_obs <- time_table %>% 
  dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  dplyr::filter((observations <= 200000)) %>%
  gather(key = "time_type", value = "time", -c(B:method), -batch_size_perc)  %>%
  dplyr::filter(time_type == "elapsed_time") %>%
  dplyr::group_by(method, observations, batch_size_perc, time_type) %>% 
  dplyr::summarize(mean = mean(time), 
                   sd = sd(time)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
       labs(title = "Elapsed Time for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Time (seconds)") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "none", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_time_obs
```


### memory and time (up to a million cells)

Performance of memory usage as a function of increasing number of 
cells and batch sizes. 

```{r}
p_mem_obs_all <- mem_table %>%
  dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  dplyr::filter(!(observations %in% c(250e3, 300e3, 375e3, 400e3, 450e3))) %>%
  dplyr::group_by(method, observations, batch_size_perc) %>% 
  dplyr::summarize(mean = mean(memory/1000), 
                   sd = sd(memory/1000)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line() +
          geom_point() +
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
        labs(title = "Memory Usage (RAM) for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Memory Usage (Gb)") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "top", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_mem_obs_all
```


```{r, warning=FALSE}
p_time_obs_all <- time_table %>% 
  dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  # dplyr::filter((observations <= 200000)) %>%
  gather(key = "time_type", value = "time", -c(B:method), -batch_size_perc)  %>%
  dplyr::filter(time_type == "elapsed_time") %>%
  dplyr::group_by(method, observations, batch_size_perc, time_type) %>% 
  dplyr::summarize(mean = mean(time), 
                   sd = sd(time)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
       labs(title = "Elapsed Time for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Time (seconds)") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "none", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_time_obs_all
```

## create figures

### Figure 2
```{r}
p2_abs <- ggdraw() +
    draw_plot(p_ari_obs_line_abs, x = 0, y = 0.62, width = 1, height = .38) +
    draw_plot(p_wcss_obs_line_abs, x = 0, y = 0.31, width = 1, height = .31) +
    draw_plot(p_wcss_real_abs, x = 0, y = 0, width = 1, height = .31) +
    draw_plot_label(label = LETTERS[1:3], size = 25,
                    x = c(0, 0, 0), y = c(1, 0.64, 0.33))
    
p2_abs
pdf(here::here("main", "figs", "fig2.pdf"), width = 10, height =10)
print(p2_abs)
dev.off()
```



# Supplemental Figures

## Simulated data (all N)

### Accuracy (ARI)

Using absolute batch sizes
```{r, warning=FALSE}
p_ari_obs_line_abs_all <- acc_table_abs %>% 
  dplyr::group_by(method, observations, abs_batch) %>% 
  dplyr::summarize(mean = mean(ARI), 
                   sd = sd(ARI)) %>% 
  ggplot(aes(x = abs_batch, y = mean, color = method)) +
          geom_line() +
          geom_point() +
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
      ylim(0.95, 1) + 
      labs(title = "Accuracy (ARI) for increasing number of cells using simulated data") + 
        xlab("Absolute batch sizes") + 
        ylab("Adjusted Rand Index") + 
  theme(legend.position = "top", legend.justification= "center") +
  facet_wrap(~observations, scales = "free") 
p_ari_obs_line_abs_all
```

### Accuracy (WCSS)

Using absolute batch sizes
```{r, warning=FALSE}
p_wcss_obs_line_abs_all <- acc_table_abs %>% 
  dplyr::group_by(method, observations, abs_batch) %>% 
  mutate(q90 = quantile(normal_WCSS, 0.9), row = row_number()) %>% 
  dplyr::filter(normal_WCSS <= q90) %>%
  dplyr::summarize(mean = mean(normal_WCSS), 
                   sd = sd(normal_WCSS)) %>% 
  ggplot(aes(x = abs_batch, y = mean, color = method)) +
          geom_line() +
          geom_point() +
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
     labs(title = "Accuracy (WCSS) for increasing number of cells using simulated data") + 
        xlab("Absolute batch sizes") + 
        ylab("Normalized WCSS") + 
  theme(legend.position = "top", legend.justification= "center") +
  facet_wrap(~observations, scales = "free") 
p_wcss_obs_line_abs_all
```

## TENxBrain data (all N)

### Accuracy (WCSS)

Using absolute batch sizes
```{r, warning=FALSE}
p_wcss_real_abs_all <- acc_real_table_abs %>%   
  dplyr::group_by(observations, method, abs_batch) %>% 
  mutate(q90 = quantile(normal_WCSS, 0.8), row = row_number()) %>% 
  dplyr::filter(normal_WCSS <= q90) %>%
  dplyr::summarize(mean = median(normal_WCSS), 
                   sd = sd(normal_WCSS)) %>% 
  ggplot(aes(x = abs_batch, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
  theme(legend.position = "top", legend.justification= "center") +
  labs(title = "Accuracy (WCSS) for increasing number of cells using real scRNA-seq data") + 
        xlab("Absolute batch sizes") + 
        ylab("Normalized WCSS") +
  facet_wrap(~observations, scales = "free") 
p_wcss_real_abs_all
```



# to delete 

!!!!! Everything below this point is older


### Accuracy (ARI) w/ relative batch size and simulated data
```{r, warning=FALSE}
p_ari_obs_line <- acc_table %>% 
  dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  dplyr::filter((observations <= 10e3)) %>%
  dplyr::group_by(method, observations, batch_size_perc) %>% 
  dplyr::summarize(mean = mean(ARI), 
                   sd = sd(ARI)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
      labs(title = "Accuracy (ARI) for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Adjusted Rand Index") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "none", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_ari_obs_line
```


### Accuracy (WCSS) w/ relative batch size and simulated data
```{r, warning=FALSE}
p_wcss_obs_line <- acc_table %>% 
  dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  dplyr::filter((observations <= 10e3)) %>%
  dplyr::group_by(method, observations, batch_size_perc) %>% 
  dplyr::summarize(mean = mean(normal_WCSS), 
                   sd = sd(normal_WCSS)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
     labs(title = "Accuracy (WCSS) for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Normalized WCSS") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "none", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_wcss_obs_line
```


### Accuracy (ARI) w/ relative batch size and simulated data
```{r, warning=FALSE, eval=FALSE}
p_ari_obs_line <- acc_table %>% 
  # dplyr::filter((batch_size %in% c(0.005, 0.05, 0.20)))%>%
  dplyr::filter((observations <= 10e3)) %>%
  dplyr::group_by(method, observations, batch_size_perc) %>% 
  dplyr::summarize(mean = mean(ARI), 
                   sd = sd(ARI)) %>% 
  ggplot(aes(x = observations/1e3, y = mean, color = method)) +
          geom_line()+
          geom_point()+
          geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                position=position_dodge(0.05))+
      labs(title = "Accuracy (ARI) for increasing number of cells and batch size") + 
        xlab("Number of cells (thousands)") + 
        ylab("Adjusted Rand Index") + 
  facet_wrap(~batch_size_perc, scales = "free") + 
  theme(legend.position = "none", legend.justification= "center") +
  scale_color_discrete(name = "Method",
                       breaks=c("kmeans-new", "mbkmeans-new", "mbkmean_hdf5-new"),
                       labels=c("k-means", "mbkmeans", "mbkmeans (HDF5)")) 
p_ari_obs_line
```



```{r, eval=FALSE}
p2 <- ggdraw() + 
    draw_plot(p_mem_obs, x = 0, y = .70, width = 1, height = .30) +
    draw_plot(p_time_obs, x = 0, y = .46, width = 1, height = .24) +
    draw_plot(p_ari_obs_line, x = 0, y = 0.23, width = 1, height = .23) +
    draw_plot(p_wcss_obs_line, x = 0, y = 0, width = 1, height = .23) +
    draw_plot_label(label = LETTERS[1:4], size = 25,
                    x = c(0, 0, 0, 0), y = c(1, 0.75, 0.50, 0.25))
pdf(here::here("main", "figs", "fig-sims-memory-obs.pdf"), width = 10, height =12)
print(p2)
dev.off()
```

```{r, eval=FALSE}
p2_log <- ggdraw() + 
    draw_plot(p_mem_obs + scale_y_log10() + scale_x_log10(), x = 0, y = .70, width = 1, height = .30) +
    draw_plot(p_time_obs + scale_y_log10() + scale_x_log10(), x = 0, y = .46, width = 1, height = .24) +
    draw_plot(p_ari_obs_line, x = 0, y = 0.23, width = 1, height = .23) +
    draw_plot(p_wcss_obs_line, x = 0, y = 0, width = 1, height = .23) +
    draw_plot_label(label = LETTERS[1:4], size = 25,
                    x = c(0, 0, 0, 0), y = c(1, 0.75, 0.50, 0.25))
pdf(here::here("main", "figs", "fig-sims-memory-obs-log.pdf"), width = 10, height =12)
print(p2_log)
dev.off()
```


```{r, eval=FALSE}
p2 <- ggdraw() + 
    draw_plot(p_mem_obs_all, x = 0, y = .70, width = 1, height = .30) +
    draw_plot(p_time_obs_all, x = 0, y = .46, width = 1, height = .24) +
    draw_plot(p_ari_obs_line, x = 0, y = 0.23, width = 1, height = .23) +
    draw_plot(p_wcss_obs_line, x = 0, y = 0, width = 1, height = .23) +
    draw_plot_label(label = LETTERS[1:4], size = 25,
                    x = c(0, 0, 0, 0), y = c(1, 0.75, 0.50, 0.25))
pdf(here::here("main", "figs", "fig-sims-memory-obs-full.pdf"), width = 10, height =12)
print(p2)
dev.off()
```

```{r, eval=FALSE}
p2_log <- ggdraw() + 
    draw_plot(p_mem_obs_all + scale_y_log10() + scale_x_log10(), x = 0, y = .70, width = 1, height = .30) +
    draw_plot(p_time_obs_all + scale_y_log10() + scale_x_log10(), x = 0, y = .46, width = 1, height = .24) +
    draw_plot(p_ari_obs_line, x = 0, y = 0.23, width = 1, height = .23) +
    draw_plot(p_wcss_obs_line, x = 0, y = 0, width = 1, height = .23) +
    draw_plot_label(label = LETTERS[1:4], size = 25,
                    x = c(0, 0, 0, 0), y = c(1, 0.75, 0.50, 0.25))
pdf(here::here("main", "figs", "fig-sims-memory-obs-full-log.pdf"), width = 10, height =12)
print(p2_log)
dev.off()
```

```{r, eval=FALSE}
p2_abs <- ggdraw() +
    draw_plot(p_ari_obs_line_abs, x = 0, y = 0.67, width = 1, height = .33) +
    draw_plot(p_wcss_obs_line_abs, x = 0, y = 0.34, width = 1, height = .33) +
    draw_plot(p_wcss_real_abs, x = 0, y = 0, width = 1, height = .33) +
    draw_plot_label(label = LETTERS[1:3], size = 25,
                    x = c(0, 0, 0), y = c(1, 0.67, 0.34))
    
p2_abs
pdf(here::here("main", "figs", "fig2.pdf"), width = 10, height =12)
print(p2_abs)
dev.off()
```


Figure for Varying K
```{r, eval=FALSE}
files_vark <- list.files(path = here("output_tables/abs_batch", "acc"), 
                        pattern="*.csv", full.names=TRUE, recursive=FALSE)
acc_table_abs <- NULL
for (i in (1:length(files_acc))){
  temp_table <- read.csv(file = files_acc[i], header=TRUE, sep=",")
  acc_table_abs <- rbind(acc_table_abs, temp_table)
}
acc_table_abs <- acc_table_abs %>% 
  transform(normal_WCSS = WCSS/observations)
```